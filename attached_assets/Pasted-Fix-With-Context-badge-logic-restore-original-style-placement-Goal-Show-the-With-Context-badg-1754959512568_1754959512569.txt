Fix “With Context” badge logic + restore original style/placement
Goal:
Show the “With Context” badge only when the server returns hasContext === true for that metric insight, and restore the original badge component + placement within metric‑insight‑box.tsx.

Edit only:

client/src/components/metric-insight-box.tsx (this file renders the per‑metric insight boxfrontend_map_v1)

Steps (minimal diff):

Strict boolean check (no truthy fallthrough):

Wherever the badge is rendered, change the condition to:

tsx
Copy
Edit
const showContextBadge = insight?.hasContext === true;
Do not derive from any hasCustomContext or local state. Use the server field only. (Server holds AI insights + user context in aiInsights / insightContextsschema_reference_v1.)

Restore original Badge component + import:

Use the same badge component you used before in this app (shadcn/ui badge lives under @/components/ui/badge in this codebasefrontend_map_v1):

tsx
Copy
Edit
import { Badge } from "@/components/ui/badge";
Remove any newly added or duplicated Badge component or custom styles introduced by the last change.

Restore original placement:

Place the badge back in the original container (the one that existed before this change). If that was next to the “Add Context” button in the header/actions row, keep it there and re‑use the original classes (e.g., className="ml-2" or whatever was there before).

Do not move the badge next to the timestamp or change its variant unless that was the original. Use the same variant you used previously in this component (e.g., variant="secondary" if that’s what the original used).

Type guard (optional, 1 line):

If the DTO type exists locally, enforce boolean:

ts
Copy
Edit
type AIInsightDTO = { /* … */ hasContext: boolean };
When mapping data, do hasContext: Boolean(item.hasContext) to avoid "true" strings forcing always‑on badges.

Validation (quick):

Reload after generating + adding context: the badge appears only on the metric(s) with hasContext === true.

Reload without context: no badges render.

After delete + refetch: the badge for that metric disappears.

Network: your existing GET /api/ai-insights/:clientId?period=YYYY-MM already returns hasContext (we are just reading it), keys remain ["/api/ai-insights", clientId, period]data_flow_maps_v1frontend_map_v1.

Do not modify:

Any other components, endpoints, or stylesheets.